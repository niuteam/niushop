(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["otherpages/goods/coupon_receive/coupon_receive"],{"0517":function(e,t,n){"use strict";var o=n("2216"),i=n.n(o);i.a},2216:function(e,t,n){},"5cc0":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(n("c409"));function i(e){return e&&e.__esModule?e:{default:e}}var c={components:{},data:function(){return{info:{},couponTypeId:0,path:"",button:"领取",uid:0,couponBtnSwitch:!1,memberId:0,receivedNum:0}},mixins:[o.default],onLoad:function(t){var n=this;if(!this.addonIsExit.coupon)return this.$util.showToast({title:"商家未开启优惠券",mask:!0,duration:2e3}),void setTimeout((function(){n.$util.redirectTo("/pages/index/index/index",{},"redirectTo")}),2e3);if(t.source_member&&e.setStorageSync("source_member",t.source_member),t.coupon_type_id&&(this.couponTypeId=t.coupon_type_id),t.scene){var o=decodeURIComponent(t.scene);o=o.split("&"),o.length&&o.forEach((function(e){-1!=e.indexOf("coupon_type_id")&&(n.couponTypeId=e.split("-")[1]),-1!=e.indexOf("source_member")&&(n.source_member=e.split("-")[1])}))}},onShow:function(){this.$langConfig.refresh(),this.getCoupon(),this.receivedNum=0,e.getStorageSync("token")&&(this.getMemberId(),this.getReceivedNum())},onHide:function(){this.couponBtnSwitch=!1},methods:{getCoupon:function(){var t=this;this.$api.sendRequest({url:"/coupon/api/coupon/typeinfo",data:{coupon_type_id:this.couponTypeId},success:function(n){var o=n.data;o?(t.info=o,t.path=o.qrcode,t.$refs.loadingCover&&t.$refs.loadingCover.hide(),t.buttonRefresh()):(t.$util.showToast({title:n.message}),setTimeout((function(){e.navigateBack({delta:1})}),1e3))},fail:function(e){t.$refs.loadingCover&&t.$refs.loadingCover.hide()}})},receiveGoodsCoupon:function(t){var n=this;e.getStorageSync("token")?this.isCanReceive&&(this.couponBtnSwitch||(this.couponBtnSwitch=!0,this.$api.sendRequest({url:"/coupon/api/coupon/receive",data:{coupon_type_id:t,get_type:2},success:function(e){e.data;var t=e.message;0==e.code&&(t="领取成功",n.receivedNum+=1,n.buttonRefresh()),n.$util.showToast({title:t}),n.couponBtnSwitch=!1},fail:function(e){n.couponBtnSwitch=!1}}))):this.$refs.login.open("/otherpages/goods/coupon_receive/coupon_receive?coupon_type_id="+this.couponTypeId)},getMemberId:function(){var e=this;this.$api.sendRequest({url:"/api/member/id",success:function(t){t.code>=0&&(e.memberId=t.data)}})},getReceivedNum:function(){var e=this;this.$api.sendRequest({url:"/coupon/api/coupon/receivedNum",data:{coupon_type_id:this.couponTypeId},success:function(t){t.code>=0&&(e.receivedNum=t.data,e.buttonRefresh())}})},buttonRefresh:function(){this.button="领取",this.info.count==this.info.lead_count?this.button="来迟了该优惠券已被领取完了":0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum?this.button="领取":this.button="该优惠券领取已达到上限"}},computed:{isCanReceive:{get:function(){return this.info.count!=this.info.lead_count&&(0==this.info.max_fetch||0==this.receivedNum||this.info.max_fetch>this.receivedNum)}}},onShareAppMessage:function(e){var t="恭喜您获得一张"+this.info.money+"元的优惠券";1==this.info.range_type?t+=",满".concat(this.info.at_least,"全场可用"):t+=",满".concat(this.info.at_least,"部分商品可用");var n="/otherpages/goods/coupon_receive/coupon_receive?coupon_type_id="+this.couponTypeId;return this.memberId&&(n+="&source_member="+this.memberId),{title:t,path:n,success:function(e){},fail:function(e){}}}};t.default=c}).call(this,n("543d")["default"])},"7df3":function(e,t,n){"use strict";n.r(t);var o=n("5cc0"),i=n.n(o);for(var c in o)"default"!==c&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=i.a},a190:function(e,t,n){"use strict";var o=n("b785"),i=n.n(o);i.a},b785:function(e,t,n){},be37:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return o}));var o={loadingCover:function(){return n.e("components/loading-cover/loading-cover").then(n.bind(null,"790a"))},nsLogin:function(){return Promise.all([n.e("common/vendor"),n.e("components/ns-login/ns-login")]).then(n.bind(null,"2893"))}},i=function(){var e=this,t=e.$createElement,n=(e._self._c,e.$util.img(e.path)),o=0==e.info.validity_type?e.$util.timeStampTurnTime(e.info.end_time):null;e.$mp.data=Object.assign({},{$root:{g0:n,g1:o}})},c=[]},e2e1:function(e,t,n){"use strict";(function(e){n("34b0");o(n("66fd"));var t=o(n("f7ca"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},f7ca:function(e,t,n){"use strict";n.r(t);var o=n("be37"),i=n("7df3");for(var c in i)"default"!==c&&function(e){n.d(t,e,(function(){return i[e]}))}(c);n("0517"),n("a190");var u,s=n("f0c5"),r=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,"e41a39aa",null,!1,o["a"],u);t["default"]=r.exports}},[["e2e1","common/runtime","common/vendor"]]]);